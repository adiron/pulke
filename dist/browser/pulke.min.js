(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Pulke=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var NEWTON_ITERATIONS=4;var NEWTON_MIN_SLOPE=.001;var SUBDIVISION_PRECISION=1e-7;var SUBDIVISION_MAX_ITERATIONS=10;var kSplineTableSize=11;var kSampleStepSize=1/(kSplineTableSize-1);var float32ArraySupported=typeof Float32Array==="function";function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}function calcBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function binarySubdivide(aX,aA,aB,mX1,mX2){var currentX,currentT,i=0;do{currentT=aA+(aB-aA)/2;currentX=calcBezier(currentT,mX1,mX2)-aX;if(currentX>0){aB=currentT}else{aA=currentT}}while(Math.abs(currentX)>SUBDIVISION_PRECISION&&++i<SUBDIVISION_MAX_ITERATIONS);return currentT}function newtonRaphsonIterate(aX,aGuessT,mX1,mX2){for(var i=0;i<NEWTON_ITERATIONS;++i){var currentSlope=getSlope(aGuessT,mX1,mX2);if(currentSlope===0){return aGuessT}var currentX=calcBezier(aGuessT,mX1,mX2)-aX;aGuessT-=currentX/currentSlope}return aGuessT}module.exports=function bezier(mX1,mY1,mX2,mY2){if(!(0<=mX1&&mX1<=1&&0<=mX2&&mX2<=1)){throw new Error("bezier x values must be in [0, 1] range")}var sampleValues=float32ArraySupported?new Float32Array(kSplineTableSize):new Array(kSplineTableSize);if(mX1!==mY1||mX2!==mY2){for(var i=0;i<kSplineTableSize;++i){sampleValues[i]=calcBezier(i*kSampleStepSize,mX1,mX2)}}function getTForX(aX){var intervalStart=0;var currentSample=1;var lastSample=kSplineTableSize-1;for(;currentSample!==lastSample&&sampleValues[currentSample]<=aX;++currentSample){intervalStart+=kSampleStepSize}--currentSample;var dist=(aX-sampleValues[currentSample])/(sampleValues[currentSample+1]-sampleValues[currentSample]);var guessForT=intervalStart+dist*kSampleStepSize;var initialSlope=getSlope(guessForT,mX1,mX2);if(initialSlope>=NEWTON_MIN_SLOPE){return newtonRaphsonIterate(aX,guessForT,mX1,mX2)}else if(initialSlope===0){return guessForT}else{return binarySubdivide(aX,intervalStart,intervalStart+kSampleStepSize,mX1,mX2)}}return function BezierEasing(x){if(mX1===mY1&&mX2===mY2){return x}if(x===0){return 0}if(x===1){return 1}return calcBezier(getTForX(x),mY1,mY2)}}},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var utils_1=require("./utils");var Ease_1=require("./Ease");var AnimationController=function(){function AnimationController(anim){this.playing=false;this.selector=anim.selector;this.parentElm=document.querySelector(anim.selector);this.loop=anim.loop;this.duration=anim.duration;this.loopTimes=anim.loopTimes;this.items=anim.items.map(function(i){return new AnimableController(i)});this.startTime=Date.now();this.pausePlayhead=undefined;console.log("Bound animation for selector: "+this.parentElm)}AnimationController.prototype.start=function(){this.startTime=Date.now();this.playing=true;this.draw()};AnimationController.prototype.savePlayhead=function(){this.pausePlayhead=this.playhead};Object.defineProperty(AnimationController.prototype,"playhead",{get:function(){if(this.playing){return(Date.now()-this.startTime)%this.duration/this.duration}else if(this.pausePlayhead){return this.pausePlayhead}else{return 0}},set:function(n){this.scrub(n)},enumerable:true,configurable:true});AnimationController.prototype.resume=function(){if(this.pausePlayhead!==undefined){console.log("Resuming from saved playhead");this.playhead=this.pausePlayhead;this.pausePlayhead=undefined}this.playing=true;this.draw();return this.playhead};AnimationController.prototype.stop=function(){this.playing=false;this.playhead=0;return this.playhead};AnimationController.prototype.pause=function(){this.savePlayhead();this.playing=false;return this.playhead};AnimationController.prototype.draw=function(){var _this=this;var pos=this.playhead;this.setAll(pos);if(this.playing){requestAnimationFrame(function(){return _this.draw()})}else{console.log("Stopping draw loop")}};AnimationController.prototype.scrub=function(pos){pos=utils_1.clamp(pos,0,1);this.startTime=Date.now()-this.duration*pos};AnimationController.prototype.setAll=function(pos){for(var index=0;index<this.items.length;index++){var item=this.items[index];this.setOne(item,pos)}};AnimationController.prototype.setOne=function(item,pos){var itemElem=this.parentElm.querySelector(item.selector);for(var propIndex=0;propIndex<item.props.length;propIndex++){var prop=item.props[propIndex];prop.propertyObj.set(itemElem,prop.getValueAt(pos))}};return AnimationController}();exports.AnimationController=AnimationController;var AnimableController=function(){function AnimableController(animable){this.selector=animable.selector;this.props=animable.props.map(function(i){return new AnimPropController(i)})}return AnimableController}();exports.AnimableController=AnimableController;var PropertyObject=function(){function PropertyObject(propstring){var parts=propstring.split(":");if(parts.length===1){this.kind="style";this.key=propstring}else{switch(parts[0]){case"style":this.kind="style";this.key=parts[1];break;case"attr":this.kind="attr";this.key=parts[1];break;case"text":this.kind="text";this.key="";break;default:throw new Error("Unknown property kind "+parts[0])}}}PropertyObject.prototype.set=function(element,value){switch(this.kind){case"attr":element.setAttribute(this.key,value);break;case"style":element.style[this.key]=value;break;case"text":element.innerText=value;break;default:throw new Error("Unimplemented kind "+this.kind)}};return PropertyObject}();exports.PropertyObject=PropertyObject;var AnimPropController=function(){function AnimPropController(prop){this.property=prop.property;this.propertyObj=new PropertyObject(this.property);this.keyframes=prop.keyframes.map(function(i){return new KeyframeController(i)});this.unit=typeof prop.unit=="undefined"?"px":prop.unit;this.ease=prop.ease;this.easeObj=Ease_1.detectEase(prop.ease)}Object.defineProperty(AnimPropController.prototype,"keyframes",{get:function(){return this._keyframes},set:function(kfs){this._keyframes=kfs.sort(function(a,b){return a.position-b.position})},enumerable:true,configurable:true});AnimPropController.prototype.getNumberValueAt=function(position){var earlyEase;if(this.keyframes[0].position>=position){earlyEase=this.keyframes[0].easeObj?this.keyframes[0].easeObj:this.easeObj;return earlyEase.do(this.keyframes[0].value,this.keyframes[this.keyframes.length-1].value,0)}else if(this.keyframes[this.keyframes.length-1].position<=position){earlyEase=this.keyframes[this.keyframes.length-1].easeObj?this.keyframes[this.keyframes.length-1].easeObj:this.easeObj;return earlyEase.do(this.keyframes[0].value,this.keyframes[this.keyframes.length-1].value,1)}var lastNearestKF;var lastNearestKFidx;for(var i=0;i<this.keyframes.length;i++){var elm=this.keyframes[i];if(elm.position<=position){lastNearestKFidx=i}}lastNearestKF=this.keyframes[lastNearestKFidx];if(lastNearestKF.position==position){return lastNearestKF.value}var firstAfterKF=this.keyframes[lastNearestKFidx+1];var distance=firstAfterKF.position-lastNearestKF.position;var distanceInto=position-lastNearestKF.position;var normalizedDist=utils_1.mapRange(distanceInto,0,distance,0,1);var targetEase=lastNearestKF.easeObj?lastNearestKF.easeObj:this.easeObj;return targetEase.do(lastNearestKF.value,firstAfterKF.value,normalizedDist)};AnimPropController.prototype.getValueAt=function(position){return this.getNumberValueAt(position).toString()+this.unit};return AnimPropController}();exports.AnimPropController=AnimPropController;var KeyframeController=function(){function KeyframeController(kf){this.position=kf.position;this.value=kf.value;this.ease=kf.ease;if(kf.ease){this.easeObj=Ease_1.detectEase(kf.ease)}}return KeyframeController}();exports.KeyframeController=KeyframeController},{"./Ease":3,"./utils":5}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var utils_1=require("./utils");var BezierEasing=require("bezier-easing");var LinearInterpolation=function(){function LinearInterpolation(){}LinearInterpolation.prototype.do=function(v1,v2,p){p=p<0?0:p;p=p>1?1:p;return v1+(v2-v1)*p};return LinearInterpolation}();exports.LinearInterpolation=LinearInterpolation;var EaseInQuadInterpolation=function(){function EaseInQuadInterpolation(){}EaseInQuadInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(p*p,0,1,v1,v2)};return EaseInQuadInterpolation}();exports.EaseInQuadInterpolation=EaseInQuadInterpolation;var EaseOutQuadInterpolation=function(){function EaseOutQuadInterpolation(){}EaseOutQuadInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(p*(2-p),0,1,v1,v2)};return EaseOutQuadInterpolation}();exports.EaseOutQuadInterpolation=EaseOutQuadInterpolation;var EaseInOutQuadInterpolation=function(){function EaseInOutQuadInterpolation(){}EaseInOutQuadInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(p<.5?2*p*p:-1+(4-2*p)*p,0,1,v1,v2)};return EaseInOutQuadInterpolation}();exports.EaseInOutQuadInterpolation=EaseInOutQuadInterpolation;var EaseInCubicInterpolation=function(){function EaseInCubicInterpolation(){}EaseInCubicInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(p*p*p,0,1,v1,v2)};return EaseInCubicInterpolation}();exports.EaseInCubicInterpolation=EaseInCubicInterpolation;var EaseOutCubicInterpolation=function(){function EaseOutCubicInterpolation(){}EaseOutCubicInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(--p*p*p+1,0,1,v1,v2)};return EaseOutCubicInterpolation}();exports.EaseOutCubicInterpolation=EaseOutCubicInterpolation;var EaseInOutCubicInterpolation=function(){function EaseInOutCubicInterpolation(){}EaseInOutCubicInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(p<.5?4*p*p*p:(p-1)*(2*p-2)*(2*p-2)+1,0,1,v1,v2)};return EaseInOutCubicInterpolation}();exports.EaseInOutCubicInterpolation=EaseInOutCubicInterpolation;var EaseInQuartInterpolation=function(){function EaseInQuartInterpolation(){}EaseInQuartInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(p*p*p*p,0,1,v1,v2)};return EaseInQuartInterpolation}();exports.EaseInQuartInterpolation=EaseInQuartInterpolation;var EaseOutQuartInterpolation=function(){function EaseOutQuartInterpolation(){}EaseOutQuartInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(1- --p*p*p*p,0,1,v1,v2)};return EaseOutQuartInterpolation}();exports.EaseOutQuartInterpolation=EaseOutQuartInterpolation;var EaseInOutQuartInterpolation=function(){function EaseInOutQuartInterpolation(){}EaseInOutQuartInterpolation.prototype.do=function(v1,v2,p){return utils_1.mapRange(p<.5?8*p*p*p*p:1-8*--p*p*p*p,0,1,v1,v2)};return EaseInOutQuartInterpolation}();exports.EaseInOutQuartInterpolation=EaseInOutQuartInterpolation;var FrozenInterpolation=function(){function FrozenInterpolation(){}FrozenInterpolation.prototype.do=function(v1,v2,p){return v1};return FrozenInterpolation}();exports.FrozenInterpolation=FrozenInterpolation;var BezierInterpolation=function(){function BezierInterpolation(x1,y1,x2,y2){this.bezierFunction=BezierEasing(x1,y1,x2,y2)}BezierInterpolation.prototype.do=function(v1,v2,p){var n=this.bezierFunction(p);return utils_1.mapRange(n,0,1,v1,v2)};return BezierInterpolation}();exports.BezierInterpolation=BezierInterpolation;var GranularFilter=function(){function GranularFilter(ease,granularity){this.granularity=granularity;this.ease=ease}GranularFilter.prototype.do=function(v1,v2,p){var v=this.ease.do(v1,v2,p);return Math.floor(v/this.granularity)*this.granularity};return GranularFilter}();exports.GranularFilter=GranularFilter;var MapFilter=function(){function MapFilter(ease,low1,high1,low2,high2){this.ease=ease;this.low1=low1;this.high1=high1;this.low2=low2;this.high2=high2}MapFilter.prototype.do=function(v1,v2,p){var v=this.ease.do(v1,v2,p);return utils_1.mapRange(v,this.low1,this.high1,this.low2,this.high2)};return MapFilter}();exports.MapFilter=MapFilter;function parseFilterOn(s,e){var parts=s.split(/ +/);switch(parts[0]){case"granular":return new GranularFilter(e,parseFloat(parts[1]));case"map":return new MapFilter(e,parseFloat(parts[1]),parseFloat(parts[2]),parseFloat(parts[3]),parseFloat(parts[4]));default:console.log("Unknown filter: "+s);return e}}function detectEase(s){if(!s||s=="linear"){return new LinearInterpolation}var parts=s.split(":").map(function(e){return e.trim()});var interpolationParams=parts.shift().split(/ +/);var interpolationName=interpolationParams.shift();var baseObj;switch(interpolationName){case"linear":baseObj=new LinearInterpolation;break;case"in-quad":baseObj=new EaseInQuadInterpolation;break;case"out-quad":baseObj=new EaseOutQuadInterpolation;break;case"in-out-quad":baseObj=new EaseInOutQuadInterpolation;break;case"in-cubic":baseObj=new EaseInCubicInterpolation;break;case"out-cubic":baseObj=new EaseOutCubicInterpolation;break;case"in-out-cubic":baseObj=new EaseInOutCubicInterpolation;break;case"in-quart":baseObj=new EaseInQuartInterpolation;break;case"out-quart":baseObj=new EaseOutQuartInterpolation;break;case"in-out-quart":baseObj=new EaseInOutQuartInterpolation;break;case"frozen":baseObj=new FrozenInterpolation;break;case"bezier":baseObj=new BezierInterpolation(parseFloat(interpolationParams[0]),parseFloat(interpolationParams[1]),parseFloat(interpolationParams[2]),parseFloat(interpolationParams[3]));break;default:console.log("Unknown ease '"+s+"'. Defaulting to linear.");return new LinearInterpolation}for(var i=0;i<parts.length;i++){baseObj=parseFilterOn(parts[i],baseObj)}return baseObj}exports.detectEase=detectEase},{"./utils":5,"bezier-easing":1}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Controllers_1=require("./Controllers");var Pulke=function(){function Pulke(anim){this.bound=false;this.animations=[];if(anim){this.load(anim)}}Pulke.prototype.scrub=function(position){this.animations.forEach(function(e){return e.scrub(position)})};Pulke.prototype.load=function(anim){var c=new Controllers_1.AnimationController(anim);this.animations.push(c);return c};Pulke.prototype.bind=function(){this.bound=true};Pulke.prototype.start=function(){this.animations.forEach(function(e){return e.start()})};Pulke.prototype.resume=function(){return this.animations.map(function(e){return e.resume()})};Pulke.prototype.pause=function(){return this.animations.map(function(e){return e.pause()})};Pulke.prototype.stop=function(){return this.animations.map(function(e){return e.stop()})};Object.defineProperty(Pulke.prototype,"playing",{get:function(){return this.animations.some(function(a){return a.playing})},enumerable:true,configurable:true});return Pulke}();exports.Pulke=Pulke},{"./Controllers":2}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function mapRange(value,low1,high1,low2,high2){return low2+(high2-low2)*(value-low1)/(high1-low1)}exports.mapRange=mapRange;function clamp(value,min,max){return Math.min(Math.max(value,min),max)}exports.clamp=clamp},{}]},{},[4])(4)});
